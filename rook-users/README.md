# Rook Users package

This package allows [clients](https://docs.tryrook.io/docs/Definitions/#client) to register
their [Users](https://docs.tryrook.io/docs/Definitions/#User) in ROOK server.

## Features

* Register users in Health Connect

## Installation

![Pub Version](https://img.shields.io/pub/v/rook_users?style=for-the-badge&logo=flutter&label=pubdev&color=7200F7)

```text
flutter pub add rook_users
```

### Development environment

This package was developed with the following sdk constraints:

* dart: ">=3.0.0 <4.0.0"
* flutter: ">=3.0.0"

## Getting started

### Android configuration

In your build.gradle (app) set your min and target sdk version like below:

```groovy
minSdk 26
targetSdk 34
```

### Logging

If you want to see the logs generated by this package

Install the logging package:

```yaml
logging: ">=1.0.0 <2.0.0"
```

Add the following snippet in your `main()` function:

```dart
void main() {
  Logger.root.level = Level.ALL;
  Logger.root.onRecord.listen((record) {
    if (kDebugMode) {
      print('${record.level.name}: ${record.time}: ${record.message}');
    }
  });

  runApp(RookApp());
}
```

### Environment

The `RookUsersEnvironment` enum allows to quickly configure the behaviour of **rook-users**, e.g. the
api used to communicate with ROOK servers.

Available environments:

* sandbox ➞ Use this during your app development process.
* production ➞ Use this ONLY when your app is published to the PlayStore.

You can use the `kDebugMode` property of you app to configure the environment:

```dart

const environment = kDebugMode ? RookUsersEnvironment.sandbox : RookUsersEnvironment.production;
```

## Usage

Import rook_users:

```dart
import 'package:rook_users/rook_users.dart';
```

### Initialization

To initialize this SDK call `RookUsersConfiguration.initRookUsers` and provide:

* [clientUUID](https://docs.tryrook.io/docs/Definitions/#client_uuid)
* [Environment](#environment)

```dart
void initialize() {
  const environment = kDebugMode ? RookUsersEnvironment.sandbox : RookUsersEnvironment.production;

  RookUsersConfiguration.initRookUsers(
    Secrets.clientUUID,
    environment,
  ).then((value) {
    // Initialized
  }).catchError((exception) {
    final error = 'RookUsersConfiguration: $exception';

    // Error initializing
  });
}
```

#### Recommendations

When you call `initRookUsers` an HTTP request is made, so you should only call it once. We recommend to code this
process in your application's initialization.

### RookUsersManager

Create an instance of `RookUsersManager` providing:

* [clientUUID](https://docs.tryrook.io/docs/Definitions/#client_uuid)
* [secretKey](https://docs.tryrook.io/docs/Definitions/#secret_key)

```dart

final rookUsersManager = RookUsersManager(
  clientUUID,
  secretKey,
);
```

### Registering users

To register a user call `registerRookUser` providing a userID and a userType. It
will return an instance of `RookUser`. After a successful registration it will store a `RookUser`
instance in preferences so the next time you call `registerRookUser` the local value will be
returned. Unless you provide a different userID, in that case it will behave like the first time.

The `userID` is defined by you, so feel free to use the same ID your app uses to identify it's
users. If you provide an ID which is already exists in the server it will only store it in
preferences.

The `userType` determines where the user will be created. E.g. if you want to create a user for
Health Connect use `UserType.HEALTH_CONNECT`:

```dart
void register() async {
  try {
    await Future.delayed(const Duration(seconds: 1));

    final user = await rookUsersManager.registerRookUser(userID, UserType.healthConnect);

    // Success
  } catch (e) {
    // Manage error
  }
}
```

* Before calling `registerRookUser` we recommend to wait somewhere in between 1 - 3 seconds, so the
  package loads all necessary resources.

### Removing registered users

If you want to remove a userID from a data source call `deleteUserFromRook` and provide a userID and a
userType. Once removed rook servers won't accept any health data from the specified data source.

```dart
void deleteUser() async {
  try {
    await rookUsersManager.deleteUserFromRook(userID, userType);

    // Success
  } catch (e) {
    // Manage error
  }
}
```

## Additional information

The first time your users use this package they MUST have an active internet connection otherwise
the request will fail and the userID won't be registered or stored.

RookUser instances are stored in device's shared preferences, if your app is also using shared
preferences keep in mind that calling `clear` on the SharedPreferences instance will also delete
this package registries.

## Other resources

* See a complete list of `RookUsersManager` methods in
  the [API Reference](https://pub.dev/documentation/rook_users/latest/rook_users/RookUsersManager-class.html)
* Download and compile the demo application from
  our [Repository](https://github.com/RookeriesDevelopment/rook_demo_app_flutter)