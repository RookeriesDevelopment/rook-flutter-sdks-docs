# Rook Transmission package

This package allows apps to send health data to RookConnect servers.

## Features

* Send sleep summaries
* Send physical summaries
* Send physical events
* Send body summaries

## Installation

![Pub Version](https://img.shields.io/pub/v/rook_transmission?color=%23F44336)

```text
flutter pub add rook_transmission
```

This package requires flutter `3.3.0` or higher.

## Getting started

To get authorization to use this package, you'll need to install and configure
the [rook-auth](https://pub.dev/packages/rook_auth) package.

### Android configuration

In your build.gradle (app) set your min and target sdk version like below:

```groovy
minSdk 26
targetSdk 33
```

### Logging

If you want to see the logs generated by this package

Install the logging package:

```yaml
logging: ">=1.0.0 <2.0.0"
```

Add the following snippet in your `main()` function:

```dart
void main() {
  Logger.root.level = Level.ALL;
  Logger.root.onRecord.listen((record) {
    if (kDebugMode) {
      print('${record.level.name}: ${record.time}: ${record.message}');
    }
  });

  runApp(RookApp());
}
```

## Usage

Import rook_transmission:

```dart
import 'package:rook_transmission/rook_transmission.dart';
```

Create an instance of `RookTransmissionManager` providing :

* An [apiURL](https://docs.tryrook.io/docs/Definitions#api_url) without HTTPS.
* A [userID](https://docs.tryrook.io/docs/Definitions#user_id)
    * The userID must be previously registered using
      the [rook-users](https://pub.dev/packages/rook_users) package.
* A [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)
* A [clientPassword](https://docsbeta.tryrook.io/docs/Definitions#client_password)

```dart

final RookTransmissionManager manager = RookTransmissionManager(
  'api.rook-connect.dev',
  userID,
  clientUUID,
  clientPassword,
);
```

### Enqueueing

There are multiple functions to enqueue health data they follow the convention `enqueue_data_type`
when calling any of these functions you'll need to provide an instance of the required data type.

Enqueued data will be stored in an internal database until it is uploaded.

To enqueue a Sleep Summary call `enqueueSleepSummary` and provide an instance of `SleepSummaryItem`:

```dart
void enqueueSleep() async {
  try {
    final item = SleepSummaryItem(
      sourceOfData: 'Health Connect',
      dateTime: dateTime,
      sleepStartDatetime: startDatetime,
      sleepEndDatetime: startDatetime.add(const Duration(hours: 8)),
      sleepDate: startDatetime,
      sleepDurationSeconds: 64800,
      timeInBedSeconds: 64800,
    );

    await manager.enqueueSleepSummary(item);

    // Success
  } catch (error) {
    // Manage error
  }
}
```

Remember to send the dates and date times with UTC timezone.

rook_extraction packages like [rook_health_connect](https://pub.dev/packages/rook_health_connect)
deliver the date with ISO-8601 (UTC) format like `2023-01-06T22:00:22.065Z`.

### Clear queue

If you want to clear queued data, so it won't be sent the next time you perform an upload
call `clearQueued_data_type`:

```dart
void clearSleepSummaryQueue() async {
  try {
    await manager.clearQueuedSleepSummaries();

    // Success
  } catch (error) {
    // Manage error
  }
}
```

### Uploading

To upload (send) all enqueued health data call `uploadAll`, this will upload all types of data and
delete them from the internal Database.

```dart
void uploadAll() async {
  try {
    await manager.uploadAll();

    // Success
  } catch (error) {
    // Manage error
  }
}
```

* You can also upload specific types of data these functions will follow the convention:
  `upload_data_type`.